var gdjs;(function(b){const g=GlobalPIXIModule.PIXI;class C{constructor(n,a){this._debugDraw=null;this._debugDrawContainer=null;this._profilerText=null;this._showCursorAtNextRender=!1;this._pixiRenderer=a?a.getPIXIRenderer():null,this._runtimeScene=n,this._pixiContainer=new g.Container,this._debugDrawRenderedObjectsPoints={},this._pixiContainer.sortableChildren=!0,this._debugDraw=null}onGameResolutionResized(){if(!this._pixiRenderer)return;const n=this._runtimeScene.getGame();this._pixiContainer.scale.x=this._pixiRenderer.width/n.getGameResolutionWidth(),this._pixiContainer.scale.y=this._pixiRenderer.height/n.getGameResolutionHeight()}onSceneUnloaded(){}render(){!this._pixiRenderer||(this._pixiRenderer.backgroundColor=this._runtimeScene.getBackgroundColor(),this._pixiRenderer.render(this._pixiContainer),this._showCursorAtNextRender&&(this._pixiRenderer.view.style.cursor="",this._showCursorAtNextRender=!1))}_renderProfileText(){const n=this._runtimeScene.getProfiler();if(!n)return;this._profilerText||(this._profilerText=new g.Text(" ",{align:"left",stroke:"#FFF",strokeThickness:1}),this._pixiContainer.addChild(this._profilerText));const a=n.getFramesAverageMeasures(),c=[];b.Profiler.getProfilerSectionTexts("All",a,c),this._profilerText.text=c.join(`
`)}renderDebugDraw(n,a,c,u){(!this._debugDraw||!this._debugDrawContainer)&&(this._debugDrawContainer=new g.Container,this._debugDraw=new g.Graphics,this._debugDrawContainer.addChild(this._debugDraw),this._pixiContainer.addChild(this._debugDrawContainer));const t=this._debugDraw;for(let r in this._debugDrawRenderedObjectsPoints)this._debugDrawRenderedObjectsPoints[r].wasRendered=!1;const f=(r,e,i,h,o)=>{t.line.color=i,t.fill.color=i,t.drawCircle(h,o,3),c&&(r[e]||(r[e]=new g.Text(e,{fill:i,fontSize:12}),this._debugDrawContainer.addChild(r[e])),r[e].position.set(h,o))};t.clear(),t.beginFill(),t.alpha=.8,t.lineStyle(2,255,1);for(let r=0;r<n.length;r++){const e=n[r],i=this._runtimeScene.getLayer(e.getLayer());if((!e.isVisible()||!i.isVisible())&&!a||!e.getRendererObject())continue;const o=e.getAABB();t.fill.alpha=.2,t.line.color=7835368,t.fill.color=7835368;const s=[];s.push.apply(s,i.convertInverseCoords(o.min[0],o.min[1])),s.push.apply(s,i.convertInverseCoords(o.max[0],o.min[1])),s.push.apply(s,i.convertInverseCoords(o.max[0],o.max[1])),s.push.apply(s,i.convertInverseCoords(o.min[0],o.max[1])),t.drawPolygon(s)}for(let r=0;r<n.length;r++){const e=n[r],i=this._runtimeScene.getLayer(e.getLayer());if((!e.isVisible()||!i.isVisible())&&!a||!e.getRendererObject())continue;const o=e.id;this._debugDrawRenderedObjectsPoints[o]||(this._debugDrawRenderedObjectsPoints[o]={wasRendered:!0,points:{}});const s=this._debugDrawRenderedObjectsPoints[o];s.wasRendered=!0;const x=e.getHitBoxes();for(let d=0;d<x.length;d++){const l=[];x[d].vertices.forEach(_=>{_=i.convertInverseCoords(_[0],_[1]),l.push(_[0]),l.push(_[1])}),t.fill.alpha=0,t.line.alpha=.5,t.line.color=16711680,t.drawPolygon(l)}t.fill.alpha=.3;const R=i.convertInverseCoords(e.getCenterXInScene(),e.getCenterYInScene());f(s.points,"Center",16776960,R[0],R[1]);const p=i.convertInverseCoords(e.getX(),e.getY());if(f(s.points,"Position",16711680,p[0],p[1]),e instanceof b.SpriteRuntimeObject){let d=e.getPointPosition("origin");(Math.abs(d[0]-p[0])>=1||Math.abs(d[1]-p[1])>=1)&&(d=i.convertInverseCoords(d[0],d[1]),f(s.points,"Origin",16711680,d[0],d[1]))}if(u&&e instanceof b.SpriteRuntimeObject){if(!e._animationFrame)continue;for(const d in e._animationFrame.points.items){let l=e.getPointPosition(d);l=i.convertInverseCoords(l[0],l[1]),f(s.points,d,255,l[0],l[1])}}}for(const r in this._debugDrawRenderedObjectsPoints){const e=this._debugDrawRenderedObjectsPoints[r];if(e.wasRendered)continue;const i=e.points;for(const h in i)this._debugDrawContainer.removeChild(i[h])}t.endFill()}clearDebugDraw(){this._debugDraw&&this._debugDraw.clear(),this._debugDrawContainer&&(this._debugDrawContainer.destroy({children:!0}),this._pixiContainer.removeChild(this._debugDrawContainer)),this._debugDraw=null,this._debugDrawContainer=null,this._debugDrawRenderedObjectsPoints={}}hideCursor(){this._showCursorAtNextRender=!1,!!this._pixiRenderer&&(this._pixiRenderer.view.style.cursor="none")}showCursor(){this._showCursorAtNextRender=!0}getPIXIContainer(){return this._pixiContainer}getPIXIRenderer(){return this._pixiRenderer}setLayerIndex(n,a){const c=n.getRenderer();let u=c.getRendererObject();n.isLightingLayer()&&(u=c.getLightingSprite()),!!u&&this._pixiContainer.children.indexOf(u)!==a&&(this._pixiContainer.removeChild(u),this._pixiContainer.addChildAt(u,a))}}b.RuntimeScenePixiRenderer=C,b.RuntimeSceneRenderer=b.RuntimeScenePixiRenderer})(gdjs||(gdjs={}));
//# sourceMappingURL=runtimescene-pixi-renderer.js.map
