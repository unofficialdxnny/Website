var gdjs;(function(u){const F=new u.Logger("Font manager"),h=f=>!!(f.startsWith("https://project-resources.gdevelop.io/")||f.startsWith("https://project-resources-dev.gdevelop.io/"));class l{constructor(e){this._loadedFontFamily={};this._loadedFonts={};this._filenameToFontFamily={};this._resources=e}setResources(e){this._resources=e}getFontFamily(e){return this._loadedFontFamily[e]?this._loadedFontFamily[e]:"Arial"}getFontFile(e){return this._loadedFonts[e]?this._loadedFonts[e].file||"":e}_getFontFamilyFromFilename(e){if(this._filenameToFontFamily[e])return this._filenameToFontFamily[e];let o="gdjs_font_"+e.toLowerCase().replace(/[^\w]/gi,"-");const a=o;let r=2;for(;this._filenameToFontFamily[o];)o=o+"-"+r,r++;return this._filenameToFontFamily[e]=a}static _loadFont(e,o){const a={},r="url("+encodeURI(o)+")";if(typeof FontFace!="undefined")return fetch(o,{credentials:h(o)?"include":"same-origin"}).then(n=>{if(!n.ok){const i="Unable to fetch "+o+" to be loaded as a font. HTTP status is: "+n.status+".";throw F.error(i),new Error(i)}return n.arrayBuffer()}).then(n=>{const i=new FontFace(e,n,a);document.fonts.add(i)});{const n=document.createElement("style");return n.appendChild(document.createTextNode("@font-face { font-family: '"+e+"'; src: "+r+"; }")),document.head.appendChild(n),new FontFaceObserver(e,a).load()}}loadFonts(e,o){const a=this._resources,r={};for(let s=0,c=a.length;s<c;++s){const t=a[s];if(t.file&&t.kind==="font"){if(this._loadedFonts[t.name])continue;r[t.file]=r[t.file]?r[t.file].concat(t):[t]}}const n=Object.keys(r).length;if(n===0)return o(n);let i=0;const d=this;function g(s,c){c.forEach(function(t){d._loadedFontFamily[t.name]=s,d._loadedFonts[t.name]=t}),i++,e(i,n),i===n&&o(n)}Object.keys(r).forEach(function(s){const c=d._getFontFamilyFromFilename(s),t=r[s];l._loadFont(c,s).then(function(){g(c,t)},function(m){F.error('Error loading font resource "'+t[0].name+'" (file: '+s+"): "+(m.message||"Unknown error")),g(c,t)})})}}u.FontFaceObserverFontManager=l,u.FontManager=l})(gdjs||(gdjs={}));
//# sourceMappingURL=fontfaceobserver-font-manager.js.map
